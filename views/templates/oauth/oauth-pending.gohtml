<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>{{.BrowserTitle}}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            background: white;
            font-family: "DejaVu Sans Mono", monospace;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-size: 14px; }
        .pending-page {
            width: 400px;
            padding: 14% 0 0;
            margin: auto; }
        .box {
            position: absolute;
            box-sizing: border-box;
            z-index: 1;
            top: 50%;
            left: 50%;
            max-width: 400px;
            margin: 0 0 0 -100px;
            text-align: center; }
        .box span {
            font-size: 32px;
            display: flex;
            animation: loader 1.25s infinite; }
        @keyframes loader {
            0% { rotate: 0deg; }
            100% { rotate: 360deg; }}
    </style>
</head>
<body>
<div class="pending-page">
    <div class="box" data-request-id="{{.RequestId}}">
        Подождите пару секунд... <span>&#x1F60E;</span>
    </div>
</div>
{{asset "assets/js/jquery.min.js"}}
<script>
    $(function () {
        var request_id = $('.box').data('request-id');
        console.log(request_id);

        var interval_id = setInterval(function () {
            $.ajax({
                url: '/oauth/check/' + request_id,
                type: 'GET',
                success: function(data) {
                    console.log(data);
                    if (data.status) {
                        if (data.status === 'ok' && data.redirect_url) {
                            clearInterval(interval_id);
                            window.location.assign(data.redirect_url);
                        } else if (data.status === 'error') {
                            $('.box').html('Непонятная ошибка <span>&#x1F914;</span><br><a href="/">На главную</a>');
                            clearInterval(interval_id);
                        }
                    }
                },
                error: function () {
                    console.log('Непонятная ошибка &#x1F914;');
                    $('.box').html('Непонятная ошибка <span>&#x1F914;</span><br><a href="/">На главную</a>');
                    clearInterval(interval_id);
                }
            });
        }, 1250);
    });
</script>
</body>
</html>
